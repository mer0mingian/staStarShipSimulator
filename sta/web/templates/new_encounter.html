{% extends "base.html" %}

{% block title %}New Encounter - STA Starship Simulator{% endblock %}
{% block header %}New Encounter{% endblock %}

{% block content %}
<form method="POST">
    <div class="grid">
        <div class="panel">
            <h2>Encounter Details</h2>
            <label for="name">Encounter Name</label>
            <input type="text" name="name" id="name" value="Battle at the Neutral Zone" style="width: 100%;">
        </div>

        <div class="panel">
            <h2>Your Position</h2>
            <label for="position">Bridge Station</label>
            <select name="position" id="position" style="width: 100%;">
                {% for pos in positions %}
                    <option value="{{ pos }}" {% if pos == 'captain' %}selected{% endif %}>
                        {{ pos.title() }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>

    <div class="grid">
        <div class="panel">
            <h2>Character</h2>
            <label>
                <input type="radio" name="character_action" value="generate" checked>
                Generate Random Character
            </label>
            {% if characters %}
                <label>
                    <input type="radio" name="character_action" value="existing">
                    Use Existing:
                </label>
                <select name="character_id" style="width: 100%;">
                    {% for char in characters %}
                        <option value="{{ char.id }}">{{ char.name }} ({{ char.rank }})</option>
                    {% endfor %}
                </select>
            {% endif %}
        </div>

        <div class="panel">
            <h2>Your Ship</h2>
            <label>
                <input type="radio" name="ship_action" value="generate" checked>
                Generate Random Ship
            </label>
            {% if ships %}
                <label>
                    <input type="radio" name="ship_action" value="existing">
                    Use Existing:
                </label>
                <select name="ship_id" style="width: 100%;">
                    {% for ship in ships %}
                        <option value="{{ ship.id }}">{{ ship.name }} ({{ ship.ship_class }}-class)</option>
                    {% endfor %}
                </select>
            {% endif %}
        </div>
    </div>

    <div class="panel">
        <h2>Enemy Ship</h2>
        <p style="margin-bottom: 15px;">A random enemy ship will be generated for this encounter.</p>

        <label for="crew_quality">Crew Quality</label>
        <select name="crew_quality" id="crew_quality" style="width: 100%; margin-bottom: 10px;">
            <option value="basic">Basic (Attribute 8, Department 1) - Green crew</option>
            <option value="proficient">Proficient (Attribute 9, Department 2) - Competent crew</option>
            <option value="talented" selected>Talented (Attribute 10, Department 3) - Skilled crew</option>
            <option value="exceptional">Exceptional (Attribute 11, Department 4) - Elite crew</option>
        </select>
        <p style="font-size: 0.85em; color: var(--lcars-tan);">
            NPC ships use Crew Quality for all task rolls. Higher quality = more dangerous enemy.
        </p>
    </div>

    <div class="panel" style="border-color: var(--lcars-purple);">
        <h2 style="color: var(--lcars-purple);">Your Role</h2>
        <p style="color: var(--lcars-tan); margin-bottom: 15px;">Select how you want to join this encounter:</p>
        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #222; border-radius: 5px; flex: 1; min-width: 150px;">
                <input type="radio" name="role" value="player" checked>
                <div>
                    <strong style="color: var(--lcars-orange);">Player</strong>
                    <div style="font-size: 0.85em; color: var(--lcars-tan);">Control your character and ship</div>
                </div>
            </label>
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: #222; border-radius: 5px; flex: 1; min-width: 150px;">
                <input type="radio" name="role" value="gm">
                <div>
                    <strong style="color: var(--lcars-purple);">Game Master</strong>
                    <div style="font-size: 0.85em; color: var(--lcars-tan);">Oversee encounter and control enemies</div>
                </div>
            </label>
        </div>
    </div>

    <button type="submit" class="btn">Start Encounter</button>
    <a href="{{ url_for('main.index') }}" class="btn" style="background: #666;">Cancel</a>
</form>
{% endblock %}
