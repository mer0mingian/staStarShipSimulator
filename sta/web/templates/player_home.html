{% extends "base.html" %}

{% block title %}Player - STA Starship Simulator{% endblock %}

{% block header %}Player Station{% endblock %}

{% block sidebar_nav %}
<a href="{{ url_for('main.index') }}" class="lcars-sidebar-btn color-6">Back</a>
{% endblock %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    {% if my_campaigns %}
    <!-- My Campaigns Panel -->
    <div class="lcars-bar bar-orange">My Campaigns</div>
    <div class="lcars-panel panel-orange">
        <p class="text-muted mb-2">Campaigns you've already joined</p>
        <ul class="lcars-action-list">
            {% for campaign in my_campaigns %}
            <li class="lcars-action-item">
                <a href="{{ url_for('campaigns.player_dashboard', campaign_id=campaign.campaign_id) }}"
                   style="color: inherit; text-decoration: none; display: block;">
                    <div class="action-name">{{ campaign.name }}</div>
                    {% if campaign.description %}
                    <div class="action-desc">{{ campaign.description[:60] }}{% if campaign.description|length > 60 %}...{% endif %}</div>
                    {% endif %}
                </a>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Join Campaign Panel -->
    <div class="lcars-bar-capped">
        <div class="bar-cap" style="background: var(--lcars-ice);"></div>
        <div class="bar-content">Join a Campaign</div>
        <div class="bar-cap" style="background: var(--lcars-bluey);"></div>
    </div>
    <div class="lcars-panel panel-blue">
        <p class="text-muted mb-2">Enter a campaign code from your Game Master</p>

        <form id="join-form" class="lcars-grid-2" style="align-items: end; gap: 15px;">
            <div>
                <label class="lcars-label" for="campaign-code">Campaign Code</label>
                <input type="text" id="campaign-code" class="lcars-input" placeholder="e.g., abc12345">
            </div>
            <div>
                <button type="submit" class="lcars-btn btn-ice" style="width: 100%;">Join</button>
            </div>
        </form>
    </div>

    {% if campaigns %}
    <!-- Available Campaigns Panel -->
    <div class="lcars-bar" style="background: var(--lcars-almond);">Available Campaigns</div>
    <div class="lcars-panel">
        <p class="text-muted mb-2">Or browse available campaigns to join</p>
        <ul class="lcars-action-list">
            {% for campaign in campaigns %}
            {% if campaign not in my_campaigns %}
            <li class="lcars-action-item">
                <a href="{{ url_for('campaigns.join_campaign', campaign_id=campaign.campaign_id) }}"
                   style="color: inherit; text-decoration: none; display: block;">
                    <div class="action-name">{{ campaign.name }}</div>
                    <div class="action-desc">
                        <span class="lcars-pill" style="font-size: 0.65rem;">{{ campaign.campaign_id }}</span>
                    </div>
                </a>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Navigation -->
    <div class="mt-3">
        <a href="{{ url_for('main.index') }}" class="lcars-btn btn-sm" style="background: var(--lcars-gray);">
            Back to Role Selection
        </a>
    </div>
</div>

<script>
document.getElementById('join-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const code = document.getElementById('campaign-code').value.trim();
    if (code) {
        window.location.href = `/campaigns/${code}/join`;
    }
});
</script>
{% endblock %}
